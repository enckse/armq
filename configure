#!/bin/bash

_integrate=""
_dmdflags=""
_renames=""
_disables=""
echo "checking integration type...$1"
if [ ! -z "$1" ]; then
    if [ -z "$ARMQ_HOST" ]; then
        echo "armq host must be set for integrations"
        exit 1
    fi
fi
case $1 in
    "r3")
        _renames="s/broadcast/r3_extension/g;s/debugger/armq_debug/g"
        _dmdflags="R3"
        _integrate="r3"
        _disables="s/sendrcv//g"
        ;;
    "prefix")
        _dmdflags="Prefix"
        ;;
esac

export ARMQ_PORT=$ARMQ_PORT
export ARMQ_HOST=$ARMQ_HOST
export DISABLE=$_disables
export RENAMES=$_renames
export ARMQ_INTEGRATE=$_integrate
export DMD=$DMD
if [ ! -z "$_dmdflags" ]; then
    export DMD_FLAGS="-version=$_dmdflags"
fi
./generate.sh
